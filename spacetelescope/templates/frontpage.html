{% extends "core.html" %}

{% load djangoplicity_datetime %}
{% load media_video %}
{% load pages %}
{% load i18n %}
{% load static %}

{% block extra_header %}
    <meta property="og:title" content="ESA/Hubble Space Telescope" />
    <meta property="og:description" content="The ESA page for the Hubble Space Telescope, the space-based observatory that has revolutionised modern astronomy." />
    <meta property="og:image" content="http://www.spacetelescope.org/static/archives/images/screen/hubble_earth_sp01.jpg" />
    <meta property="og:image:secure_url" content="https://www.spacetelescope.org/static/archives/images/screen/hubble_earth_sp01.jpg" />

    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v9.0" nonce="n9nP9JNb"></script>
    <script async src="https://platform.twitter.com/widgets.js" max-w charset="utf-8"></script>
{% endblock %}

{% block content_area %}
<div class="container-fluid my-3">
    <canvas id="webgl" class="webgl">
        
    </canvas>
</div>

<div id="fb-root"></div>

<div id="pr-carousel-wrapper">
    <div id="pr-carousel">
        {% if release %}
        {% for release in releases %}
        <div class="slide">
            <a href="{{ release.get_absolute_url }}">
            {% if release.main_image.resource_banner1920 %}
                <img draggable="false" data-lazy="{{ release.main_image.resource_banner1920.url }}" alt="{{ release.main_image.title }}">
            {% else %}
                <img draggable="false" data-lazy="{{ release.main_image.resource_wallpaper3.url }}" alt="{{ release.main_image.title }}">
            {% endif %}
            <div class="pr-content">
                <div class="pr-description">
                    <div class="pr-type">{{ release.id }} — {{ release.release_type.name }}</div>
                    <div class="pr-title">{{ release.title }}</div>
                    <div class="pr-extra">
                        <div class="pr-headline">{{ release.headline }}</div>
                    </div>
                </div>
            </div>
            </a>
        </div>  <!-- slide -->
        {% endfor %}
        {% endif %}
    </div> <!-- pr-carousel -->
</div> <!-- pr-carousel-wrapper -->

<div class="" id="body">


{% if announcements %}
    <section class=" ">
        <div class="container py-2 my-2">

            <header class="mb-3">
                <h4 class="lined lined-center text-uppercase">WHAT'S NEW</h4>
            </header>
            <div class="row">
                {% for announcement in announcements %}
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="box-image shadow  border">
                        <div class="mb-4 primary-overlay">
                            <img src="{{ announcement.main_visual.resource_thumb350x.url }}" alt="{{ announcement.main_visual.title }}"
                                class="w-100 -top" style="height: 200px; object-fit: cover;" />
                        </div>
                        <div class="text-center pb-3" >
                            <h5 class="new-title h6 text-uppercase text-primary mx-2" style="height: 70px;">
                                <a class="text-reset" href="blog-post.html" style="text-decoration: none;">{{ announcement.title }}</a>
                            </h5>
                            <p class="small text-uppercase text-muted">{{ announcement.release_date|date:"j N Y" }} — {{ announcement.id }}</p>
                            <a class="btn btn-outline-primary" href="{{ announcement.get_absolute_url }}">Read More</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>
    </section> <!-- announcements -->
{% endif %}

<div class="container py-2 my-2">
<div class="row frontpage-section middle-section">
    <div class="col-md-6 col-lg-6 col-xl-8 pe-5">

        {% if potws %}
        <div id="potw-carousel-wrapper" class="mt-5">
            
            <h4 class="lined lined-center text-uppercase col-12 col-lg-7 col-xl-8">{% trans "Picture of the Week" %}</h4>
            
            <div id="potw-carousel">
                {% for potw in potws %}
                <script>
                    var potwArray = [
                        {% for potw in potws %}
                        {
                            id: '{{ potw.id }}',
                            pk: '{{ potw.pk }}',
                            title: '{{ potw.visual.title }}',
                            src: '{{ potw.visual.resource_screen640.url }}',
                            url: '{{ potw.get_absolute_url }}',
                            potw: '{{ potw.release_date }}'
                        },
                        {% endfor %}
                    ];
                    console.log(potwArray)
                </script>
                <div class="slide">
                    <a href="{{ potw.get_absolute_url }}" style="text-decoration: none;">
                        <img src="https://cdn.spacetelescope.org/archives/images/thumb700x/potw2217a.jpg" class="w-100 shadow" style="height: 400px; object-fit: cover;">
                        <div class="potw-description">
                            <span class="date">{{ potw.release_date|datetime:"DATE" }} — {{ potw.id }}</span>
                            <span class="title mx-5">{{ potw.visual.title }}</span>
                        </div>
                    </a>
                </div> <!-- slide -->
                {% endfor %}
            </div> <!-- potw-carousel -->   
        </div>
        {% endif %}

        {% if spacesparks %}
        <div class="my-5">
            <div id="hubblecast-carousel">
                <div class="">
                    <h4 class="lined lined-center text-uppercase col-12 col-lg-7 col-xl-8">SPACE SPARKS</h4>
                    <div class="youtube-body shadow  border box-image">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/{{ spacesparks.0.youtube_video_id }}"
                            class="youtube-video shadow" title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                    </div>
                    <a  href="{{ spacesparks.0.get_absolute_url }}" style="text-decoration: none;">
                        <span class="pt-3" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20 "
                                class="me-2"
                                fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z" />
                                <path fill-rule="evenodd"
                                    d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
                            </svg>
                            {{ spacesparks.0.release_date|datetime:"DATE" }} — {{ spacesparks.0.id }}
                        </span>
                        <span class=" mx-5">
                            {{ spacesparks.0.title }}
                        </span>
                    </a>
                </div>
            </div> <!-- spacesparks-carousel -->
        </div>
        {% endif %}

        {% if potws %}
        <div id="newsletter-preview-container">
            <h4 class="lined lined-center text-uppercase col-12 col-lg-7 col-xl-8">ESA/Webb science Newsletter</h4>
            <div id="newsletter-preview">
                <a href="/newsletters/science/html/487/" style="text-decoration: none;">
                    <div class="img-wrapper">
                        <img draggable="false" src="https://esahubble.org/media/archives/newsletters/screen/487.jpg" class="w-100 shadow" style="height: 400px; object-fit: cover;" alt="Newsletter">
                    </div>
                    <div class="newsletter-description">
                        <div class="title">ESA/Hubble/JWST Science Newsletter - April 2022</div>
                    </div>
                </a>
            </div>
        </div>
        {% endif %}

        {% if hubblecasts %}
        <div id="hubblecast-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'videos_query_category' 'hubblecast' %}">{% trans "Hubblecast" %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="hubblecast-carousel">
                <div class="slide">
                    {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
                        <div class="youtube-wrapper">
                            <div id="youtube-player"></div>
                        </div>
                    {% else %}
                        {% embedvideo_subs hubblecasts.0 'medium_podcast,h264' 'hd_and_apple,hd720p_screen,dome_preview' '' hubblecasts.0.videosubtitle_set.all 0 %}
                    {% endif %}
                    <a href="{{ hubblecasts.0.get_absolute_url }}">
                        <div class="hubblecast-description{% if not hubblecasts.0.youtube_video_id or not hubblecasts.0.use_youtube %} hubblecast-description-jwplayer{% endif %}">
                            <div class="date">{{ hubblecasts.0.release_date|datetime:"DATE" }} — {{ hubblecasts.0.id }}</div>
                            <div class="title">{{ hubblecasts.0.title }}</div>
                    </div>
                    </a>
                </div>
            </div> <!-- hubblecast-carousel -->
        </div>
        {% endif %}
    </div>
    

   

    

    <div class="col-md-6 col-lg-6 col-xl-4 mt-4 ps-3">
        <div class="social-feeds">
            <div class="facebook-feeds mb-5">
                <div class="section-header">
                    <div class="section-title blue-title">
                        <h4 class="lined lined-center text-uppercase my-3">{% trans "ESA/Webb Facebook" %}</h4>
                    </div>
                </div>
                <div class="embed-responsive embed-responsive-16by9 fb-page">
                    <iframe
                        src="https://www.facebook.com/plugins/page.php?locale=en_US&href=https%3A%2F%2Fwww.facebook.com%2FESAWebb%2F&tabs=timeline&width=360&height=700&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=true&appId"
                        width="360" height="700" style="border:none;" scrolling="no" frameborder="0"
                        class="box-image" allowfullscreen="true"
                        allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
                </div>
            </div>
            <div class="twitter-feeds mb-3 px-3">
                <div class="section-header">
                    <div class="section-title blue-title">
                        <h4 class="lined lined-center text-uppercase my-3">{% trans "ESA/Webb on Twitter" %}</h4>
                    </div>
                </div>
                <a class="twitter-timeline" data-lang="en" data-height="620" data-theme="light"
                        class="ms-1"
                        href="https://twitter.com/ESA_Webb?ref_src=twsrc%5Etfw">Tweets by ESA_Webb</a>
                    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
        </div>
    </div>
</div>
</div>

{% if top100 %}
<div class="row top100">
    <div class="col-md-12">
        <div id="top100-frontpage-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'images_query_top100' %}">{% trans "Top 100 Images" %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="top100-frontpage-carousel">
                {% for image in top100 %}
                <div class="slide">
                    <a href="{{ image.get_absolute_url }}">
                        <div class="img-wrapper">
                            <img draggable="false" data-lazy="{{ image.resource_wallpaper1.url }}" class="img-responsive" alt="{{ image.title }}">
                        </div>
                        <div class="top100-description">
                            <div class="title">{{ image.title }}</div>
                        </div>
                    </a>
                </div> <!-- slide -->
                {% endfor %}
            </div> <!-- #top100-frontpage-carousel -->
        </div>
    </div>
</div>
{% endif %}

<div class="frontpage-section subscribe-to-hubble">
    <div class="container py-2 my-2">
        <div class="row my-3">
            <div class="col-md-6">
                <div class="">
                    <div class="section-header">
                        <div class="section-title blue-title">
                            <h4 class="lined lined-center text-uppercase">{% trans "Newsletter" %}</h4>
                            
                        </div>
                    </div>
                    <div id="newsletters-link ">
                        <a class="shadow  border box-image" href="/n3w-fr0nt/newsletters">
                            <img src="{% static 'frontpage/newsletters.jpg' %}" alt="Take a look to our newsletters"
                                style="object-fit: cover; width: 100%; height: 300px;" class="shadow">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="">
                    <div class="section-header">
                        <div class="section-title blue-title">
                            <h4 class="lined lined-center text-uppercase">{% trans "Subscribe to Hubble news" %}</h4>
                            
                        </div>
                    </div>
                    <div id="subscribe-link">
                        <a class="shadow  border box-image" href="/n3w-fr0nt/subscribe">
                            <img src="{% static 'frontpage/subscribe.jpg' %}" alt="Subscribe to Hubble news"
                            style="object-fit: cover; width: 100%; height: 300px;" class="shadow">
                        </a>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

</div> <!-- #body -->

{% endblock content_area %}

{% block extra_scripts %}
<script type="text/javascript">

// Load YouTube or JwPlayer
{% if hubblecasts.0 %}
    {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '263',
                width: '468',
                videoId: '{{ hubblecasts.0.youtube_video_id }}',
                playerVars: {
                    'modestbranding': 1,
                    'hl': '{{ LANGUAGE_CODE }}',
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                }
            });
            function onPlayerReady(event) {
                // event.target.setPlaybackQuality('large');
            }
        }
    {% endif %}
{% endif %}

$(document).ready(function(){
    {% if hubblecasts.0 %}
        {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
            var tag = document.createElement('script');

            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        {% else %}
            setupVideoPlayer('{{ hubblecasts.0.id }}');
        {% endif %}
    {% endif %}

    {% comment %}
    Set hover target on pr-description, this cannot be done fully in CSS
    as the image is outside the pr-description and cannot be "attached"
    by the standard hover
    {% endcomment %}
    $('.pr-description').hover(function() {
        $(this).parents('.pr-content').prev('img').toggleClass('hover');
    });

    // Set the announcements titles to the same heights:
    var annTitleSelector = '#ann-carousel .ann-description .title';
    var maxAnnHeight = Math.max.apply(null, $(annTitleSelector).map(function ()
    {
        return $(this).height();
    }).get());
    $(annTitleSelector).height(maxAnnHeight);

});

</script>
{% endblock %}

{% block addthis %}
<!-- no addthis on frontpage -->
{% endblock %}